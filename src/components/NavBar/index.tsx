import React, { useContext, useEffect, useState, FC, useRef } from 'react';
import { Message } from '@arco-design/web-react';
import { useSelector } from 'react-redux';
import { GlobalState } from '@/store/types';
import { GlobalContext } from '@/context';
import { useLocale, useMyStore } from '@/utils/hooks';
import styles from './style/index.module.less';
import defaultLocale from '@/locale';
import { logout } from '@/utils';
import NavBarMenu from './NavBarMenu';
import { useHistory } from 'react-router';
import Account from '../../../public/svg/账户.svg';
import LoginModal from '../LoginModal';
import { DetailDrawerRef } from '@/components/LoginModal/typings';
const Navbar: FC = () => {
  const t = useLocale();
  const history = useHistory();

  const loginRef = useRef<DetailDrawerRef>();
  const { state, dispatch } = useMyStore();
  const { userInfo } = state;

  const { setLang, lang, theme, setTheme } = useContext(GlobalContext);
  const text = lang;

  const changeLanguage = (value) => {
    setLang(value);
    Message.success({
      content: `Switched to ${value === 'zh-CN' ? 'chinese' : 'english'}`,
      className: styles.message,
    });
  };

  return (
    <div className={styles.navbar}>
      <div className={styles.logotext} onClick={() => history.push('/home')}>
        <svg
          width="114"
          height="20"
          viewBox="0 0 114 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M0.384 19L3.744 2.2H8.496L5.136 19H0.384ZM19.0288 5.776C20.1328 5.776 21.0688 6.008 21.8368 6.472C22.6048 6.92 23.1488 7.592 23.4688 8.488C23.8048 9.368 23.8368 10.472 23.5648 11.8L22.1248 19H17.5648L18.9088 12.232C19.0848 11.4 19.0288 10.76 18.7408 10.312C18.4688 9.864 17.9568 9.64 17.2048 9.64C16.4368 9.64 15.7888 9.88 15.2608 10.36C14.7328 10.84 14.3648 11.576 14.1568 12.568L12.8608 19H8.30081L10.8928 5.992H15.2128L14.4688 9.64L13.8928 8.584C14.5168 7.608 15.2848 6.896 16.1968 6.448C17.1248 6 18.0688 5.776 19.0288 5.776ZM25.5398 19L28.1558 5.944C28.4598 4.456 29.1238 3.256 30.1478 2.344C31.1718 1.432 32.5478 0.975999 34.2758 0.975999C34.8998 0.975999 35.4838 1.032 36.0278 1.144C36.5718 1.256 37.0358 1.432 37.4198 1.672L35.6678 4.864C35.2678 4.608 34.8198 4.48 34.3238 4.48C33.8118 4.48 33.4118 4.624 33.1238 4.912C32.8518 5.184 32.6518 5.616 32.5238 6.208L32.3318 7.192L32.0918 9.016L30.0998 19H25.5398ZM25.4438 9.88L26.1398 6.472H35.5478L34.8758 9.88H25.4438ZM41.8451 19.216C40.4691 19.216 39.2691 18.968 38.2451 18.472C37.2211 17.976 36.4291 17.288 35.8691 16.408C35.3091 15.512 35.0291 14.472 35.0291 13.288C35.0291 11.848 35.3731 10.568 36.0611 9.448C36.7491 8.312 37.6931 7.416 38.8931 6.76C40.0931 6.104 41.4691 5.776 43.0211 5.776C44.4131 5.776 45.6131 6.024 46.6211 6.52C47.6451 7 48.4371 7.68 48.9971 8.56C49.5571 9.44 49.8371 10.48 49.8371 11.68C49.8371 13.12 49.4931 14.408 48.8051 15.544C48.1171 16.68 47.1731 17.576 45.9731 18.232C44.7731 18.888 43.3971 19.216 41.8451 19.216ZM42.1091 15.592C42.7171 15.592 43.2531 15.44 43.7171 15.136C44.1811 14.816 44.5411 14.384 44.7971 13.84C45.0691 13.296 45.2051 12.656 45.2051 11.92C45.2051 11.2 44.9891 10.6 44.5571 10.12C44.1411 9.64 43.5411 9.4 42.7571 9.4C42.1491 9.4 41.6131 9.552 41.1491 9.856C40.6851 10.16 40.3171 10.592 40.0451 11.152C39.7891 11.696 39.6611 12.336 39.6611 13.072C39.6611 13.84 39.8771 14.456 40.3091 14.92C40.7411 15.368 41.3411 15.592 42.1091 15.592ZM56.5821 19.216C55.6541 19.216 54.7661 18.984 53.9181 18.52C53.0861 18.056 52.4061 17.384 51.8781 16.504C51.3501 15.624 51.0861 14.552 51.0861 13.288C51.0861 12.2 51.2701 11.2 51.6381 10.288C52.0061 9.376 52.5101 8.584 53.1501 7.912C53.8061 7.24 54.5581 6.72 55.4061 6.352C56.2701 5.968 57.1901 5.776 58.1661 5.776C59.1101 5.776 59.9341 5.936 60.6381 6.256C61.3581 6.576 61.9181 7.096 62.3181 7.816C62.7181 8.52 62.9181 9.448 62.9181 10.6C62.9181 11.752 62.7821 12.848 62.5101 13.888C62.2381 14.912 61.8301 15.824 61.2861 16.624C60.7581 17.424 60.0941 18.056 59.2941 18.52C58.5101 18.984 57.6061 19.216 56.5821 19.216ZM58.1661 15.544C58.7901 15.544 59.3261 15.392 59.7741 15.088C60.2381 14.784 60.5981 14.36 60.8541 13.816C61.1261 13.272 61.2621 12.64 61.2621 11.92C61.2621 11.168 61.0461 10.568 60.6141 10.12C60.1821 9.656 59.5821 9.424 58.8141 9.424C58.2221 9.424 57.6861 9.584 57.2061 9.904C56.7421 10.208 56.3741 10.632 56.1021 11.176C55.8461 11.72 55.7181 12.352 55.7181 13.072C55.7181 13.824 55.9341 14.424 56.3661 14.872C56.7981 15.32 57.3981 15.544 58.1661 15.544ZM60.0861 19L60.5421 16.816L61.3821 12.52L61.9821 8.224L63.3981 1.192H67.9581L64.4061 19H60.0861ZM74.5639 19.216C73.1879 19.216 71.9879 18.968 70.9639 18.472C69.9399 17.976 69.1479 17.288 68.5879 16.408C68.0279 15.512 67.7479 14.472 67.7479 13.288C67.7479 11.848 68.0919 10.568 68.7799 9.448C69.4679 8.312 70.4119 7.416 71.6119 6.76C72.8119 6.104 74.1879 5.776 75.7399 5.776C77.1319 5.776 78.3319 6.024 79.3399 6.52C80.3639 7 81.1559 7.68 81.7159 8.56C82.2759 9.44 82.5559 10.48 82.5559 11.68C82.5559 13.12 82.2119 14.408 81.5239 15.544C80.8359 16.68 79.8919 17.576 78.6919 18.232C77.4919 18.888 76.1159 19.216 74.5639 19.216ZM74.8279 15.592C75.4359 15.592 75.9719 15.44 76.4359 15.136C76.8999 14.816 77.2599 14.384 77.5159 13.84C77.7879 13.296 77.9239 12.656 77.9239 11.92C77.9239 11.2 77.7079 10.6 77.2759 10.12C76.8599 9.64 76.2599 9.4 75.4759 9.4C74.8679 9.4 74.3319 9.552 73.8679 9.856C73.4039 10.16 73.0359 10.592 72.7639 11.152C72.5079 11.696 72.3799 12.336 72.3799 13.072C72.3799 13.84 72.5959 14.456 73.0279 14.92C73.4599 15.368 74.0599 15.592 74.8279 15.592ZM81.3178 19L89.0218 11.104L88.3978 13.408L84.3898 5.992H89.1658L91.6378 10.744L89.5498 10.72L93.9898 5.992H99.0058L91.6378 13.648L92.0218 11.272L96.2458 19H91.3978L88.8538 14.104H91.0138L86.4778 19H81.3178ZM96.1772 19L103.881 11.104L103.257 13.408L99.2492 5.992H104.025L106.497 10.744L104.409 10.72L108.849 5.992H113.865L106.497 13.648L106.881 11.272L111.105 19H106.257L103.713 14.104H105.873L101.337 19H96.1772Z"
            fill="white"
          />
        </svg>
      </div>

      <div className="flex1">
        <NavBarMenu />
      </div>
      <ul className={styles.right}>
        <li style={{ marginRight: '50px' }}>
          <div className={styles.chinese}>
            <div>{text.split('-')[0].toUpperCase()}</div>
            <div className={styles.chineseDown}>
              <div className={styles.chineseDown1}>
                <div
                  className={styles.china}
                  onClick={() => {
                    changeLanguage('zh-CN');
                  }}
                >
                  中文
                </div>
                <div
                  className={styles.english}
                  onClick={() => {
                    changeLanguage('en-US');
                  }}
                >
                  English
                </div>
              </div>
            </div>
          </div>
        </li>

        <li
          style={{ marginRight: '30px' }}
          onClick={() => {
            if (!userInfo) {
              loginRef.current.init();
            }
          }}
        >
          <div className={userInfo ? styles.account : styles.loginAccount}>
            <div>
              <Account></Account>
            </div>
            {userInfo && (
              <div className={styles.accountDown}>
                <div className={styles.accountDown1}>
                  <div
                    className={styles.china}
                    onClick={() => {
                      history.push('/potofolio');
                    }}
                  >
                    Potofolio
                  </div>
                  <div
                    className={styles.english}
                    onClick={() => {
                      logout();
                    }}
                  >
                    Logout
                  </div>
                </div>
              </div>
            )}
          </div>
        </li>
        <li
          className={styles.package}
          onClick={() => {
            if (!userInfo) {
              loginRef.current.init();
            } else {
            }
          }}
        >
          <svg
            width="26"
            height="24"
            viewBox="0 0 26 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M22 2H4C2.89543 2 2 2.89543 2 4V20C2 21.1046 2.89543 22 4 22H22C23.1046 22 24 21.1046 24 20V17.5H17.5C14.4624 17.5 12 15.0376 12 12C12 8.96243 14.4624 6.5 17.5 6.5H24V4C24 2.89543 23.1046 2 22 2ZM17.5 8.5H24V15.5H17.5C15.567 15.5 14 13.933 14 12C14 10.067 15.567 8.5 17.5 8.5ZM26 20V17.5V15.5V8.5V6.5V4C26 1.79086 24.2091 0 22 0H4C1.79086 0 0 1.79086 0 4V20C0 22.2091 1.79086 24 4 24H22C24.2091 24 26 22.2091 26 20ZM17.5 10.5C16.6716 10.5 16 11.1716 16 12C16 12.8284 16.6716 13.5 17.5 13.5C18.3284 13.5 19 12.8284 19 12C19 11.1716 18.3284 10.5 17.5 10.5Z"
              fill="rgba(255,255,255,0.65)"
            />
          </svg>
        </li>
      </ul>
      <div>
        <LoginModal ref={loginRef}></LoginModal>
      </div>
    </div>
  );
};

export default Navbar;
